name: Upload Modules

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_LOGIN }}
        
      - name: rg-create
        run: |
          az group create -l brazilsouth -n rg-poc-demogenerated-dev

      - name: Create Azure Container registry
        run: |
          az deployment group create --resource-group rg-poc-demogenerated-dev --template-file ./modulos/acr.bicep --parameters appName=demogenerated environment=dev clusterNUm=001

      
      - name: Upload RG Module
        run: |
          az bicep publish --file ./modulos/rg.bicep --target br:acrdemogenerateddev001.azurecr.io/bicep/modules/rg:v1
